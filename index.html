<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Report: Agri-Connect - An AI Companion for Farmers</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        html {
            scroll-behavior: smooth;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; 
        }
        .section-card {
            background-color: white;
            border-radius: 0.75rem;
            border: 1px solid #e2e8f0;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.05), 0 2px 4px -2px rgb(0 0 0 / 0.05);
            padding: 1.5rem;
            margin-bottom: 2rem;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        @media (min-width: 768px) {
            .section-card {
                padding: 2.5rem;
            }
        }
        .section-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        h1, h2, h3 {
            font-weight: 700;
            color: #14532d; /* green-900 */
        }
        h2 {
            font-size: 1.5rem;
            line-height: 2rem;
            border-bottom: 2px solid #22c55e; /* green-500 */
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
        }
        @media (min-width: 768px) {
            h2 {
                font-size: 1.75rem;
                line-height: 2.25rem;
            }
        }
        .kpi-card {
            background: #f0fdf4; /* green-50 */
            border-left: 5px solid #22c55e; /* green-500 */
            border-radius: 0.5rem;
            padding: 1.5rem;
            text-align: center;
        }
        /* Chat bubble styles */
        #chat-log {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .chat-bubble {
            padding: 0.75rem 1rem;
            border-radius: 1.25rem;
            max-width: 85%;
            width: fit-content;
            line-height: 1.5;
            animation: pop-in 0.3s ease;
        }
        @keyframes pop-in {
            0% { transform: scale(0.9); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        .ai-bubble {
            background-color: #ecfdf5; /* green-50 */
            color: #064e3b; /* green-900 */
            border: 1px solid #d1fae5;
            border-bottom-left-radius: 0.25rem;
            align-self: flex-start;
        }
        .user-bubble {
            background-color: #166534; /* green-800 */
            color: white;
            border-bottom-right-radius: 0.25rem;
            align-self: flex-end;
        }
        .thinking-bubble {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .thinking-bubble .dot {
            width: 8px;
            height: 8px;
            background-color: #14532d;
            border-radius: 50%;
            animation: bounce 1.2s infinite ease-in-out;
        }
        .thinking-bubble .dot:nth-child(2) { animation-delay: -0.15s; }
        .thinking-bubble .dot:nth-child(3) { animation-delay: -0.3s; }
        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1.0); }
        }
    </style>
</head>
<body class="text-gray-700 antialiased">

    <!-- Header Section -->
    <header class="bg-green-800 text-white shadow-lg sticky top-0 z-50">
        <div class="container mx-auto px-4 sm:px-6 py-4 flex justify-between items-center">
             <div class="flex items-center space-x-2">
                <svg class="h-8 w-8 text-green-300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 18v-5.25m0 0a6.01 6.01 0 001.5-.189m-1.5.189a6.01 6.01 0 01-1.5-.189m3.75 7.478a12.06 12.06 0 01-4.5 0m3.75 2.311a15.045 15.045 0 01-7.5 0C4.508 19.64 2.25 16.184 2.25 12c0-4.184 2.258-7.64 5.25-9.689m7.5 0A15.045 15.045 0 0121.75 12c0 4.184-2.258 7.64-5.25 9.689" /></svg>
                <h1 class="text-2xl md:text-3xl font-bold">Agri-Connect</h1>
            </div>
            <nav class="hidden md:flex space-x-6">
                <a href="#challenge" class="hover:text-green-300 transition">The Reality</a>
                <a href="#solution" class="hover:text-green-300 transition">Our Solution</a>
                <a href="#impact" class="hover:text-green-300 transition">Impact</a>
                <a href="#live-demo" class="hover:text-green-300 transition">Live Demo</a>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 sm:px-6 py-8 md:py-12">
        
        <!-- Hero Section -->
        <section class="text-center mb-8 md:mb-12">
             <p class="text-lg md:text-xl text-green-700 font-semibold mb-2">From Kerala's Fields to Rajasthan's Soil</p>
            <h1 class="text-3xl md:text-5xl font-bold text-green-900 leading-tight">An AI Companion for Every Farmer.</h1>
            <p class="mt-4 max-w-3xl mx-auto text-base md:text-lg text-gray-600">We're bridging the information gap with instant, intelligent, and multilingual advice, turning complex agricultural challenges into simple, actionable solutions.</p>
        </section>


        <!-- The Challenge: Data & Analytics -->
        <section id="challenge" class="section-card">
            <h2>The Reality on the Ground</h2>
            <p class="mb-6 text-base">To build a tool that truly helps, we first listened. Our journey, which began with farmers in Kerala, led us to Rajasthan, where conversations with over 10,000 farmers painted a clear picture of their daily strugglesâ€”a story told in data.</p>
            
            <h3 class="text-xl font-semibold text-green-800 mb-4 mt-8">The Modern Farmer's Dilemma</h3>
            <p class="mb-6 text-gray-600">Our real-time data from Rajasthan pinpoints the most urgent needs. It's not just about farming; it's about timing, pricing, and surviving in a complex market.</p>
            <div class="grid md:grid-cols-2 gap-8">
                <div class="kpi-card">
                    <h3 class="text-lg font-semibold text-green-800 mb-2">Top Farmer Concerns (Rajasthan Data)</h3>
                    <p class="text-sm mb-4">Analysis of 10,000+ real farmer questions.</p>
                    <canvas id="queryPieChart"></canvas>
                </div>
                <div class="kpi-card">
                    <h3 class="text-lg font-semibold text-green-800 mb-2">The Daily Cost of Waiting</h3>
                     <p class="text-sm mb-4">Potential income lost per hectare, per day, while waiting for advice.</p>
                    <canvas id="costOfDelayChart"></canvas>
                </div>
            </div>
        </section>

        <!-- The Solution: Core Features -->
        <section id="solution" class="section-card">
            <h2>Our Solution: Your Digital Farming Partner</h2>
            <p class="mb-8">Agri-Connect is more than an app; it's a partner in your pocket. We built it with a farmer-first mindset, focusing on simple tools that solve big problems.</p>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 text-center">
                <!-- Feature 1: Speaks Your Language -->
                <div class="p-6 bg-gray-50 rounded-lg">
                    <img src="https://placehold.co/100x100/dcfce7/14532d?text=ðŸŒ" alt="Multilingual Icon" class="mx-auto h-20 w-20 rounded-full mb-4">
                    <h3 class="font-semibold text-lg text-green-800">Speaks Your Language</h3>
                    <p class="text-sm mt-1">Full support for Hindi, Malayalam, and English. Because advice is only useful if you can understand it.</p>
                </div>
                 <!-- Feature 2: Just Ask -->
                <div class="p-6 bg-gray-50 rounded-lg">
                    <img src="https://placehold.co/100x100/dcfce7/14532d?text=ðŸŽ¤" alt="Voice Query Icon" class="mx-auto h-20 w-20 rounded-full mb-4">
                    <h3 class="font-semibold text-lg text-green-800">Just Ask</h3>
                    <p class="text-sm mt-1">Use your voice or text to ask questions naturally. No confusing menus, no complicated forms.</p>
                </div>
                <!-- Feature 3: Market Smarts -->
                <div class="p-6 bg-gray-50 rounded-lg">
                    <img src="https://placehold.co/100x100/dcfce7/14532d?text=ðŸ“ˆ" alt="Market Prices Icon" class="mx-auto h-20 w-20 rounded-full mb-4">
                    <h3 class="font-semibold text-lg text-green-800">Market Smarts</h3>
                    <p class="text-sm mt-1">Get daily Mandi prices and demand info. Sell your crop for the price it deserves, not the price you're offered.</p>
                </div>
                <!-- Feature 4: Advice for Your Farm -->
                <div class="p-6 bg-gray-50 rounded-lg">
                    <img src="https://placehold.co/100x100/dcfce7/14532d?text=ðŸ“" alt="Location Icon" class="mx-auto h-20 w-20 rounded-full mb-4">
                    <h3 class="font-semibold text-lg text-green-800">Advice for Your Farm</h3>
                    <p class="text-sm mt-1">Our AI knows your local soil, weather, and season to give advice that's right for you, not for a textbook.</p>
                </div>
            </div>
        </section>

        <!-- System Architecture -->
        <section id="architecture" class="section-card">
            <h2>How It Works: From Question to Answer</h2>
            <p class="mb-12">We've built a smart, simple system. Hereâ€™s a look at how your question travels through our platform to bring you a clear, reliable answer in seconds.</p>
            
            <div class="flex flex-col md:flex-row justify-between items-center text-center gap-8">
                <!-- Step 1 -->
                <div class="flex flex-col items-center max-w-[200px]"><div class="flex items-center justify-center w-24 h-24 bg-green-100 rounded-full text-green-700"><svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 1.5H8.25A2.25 2.25 0 006 3.75v16.5a2.25 2.25 0 002.25 2.25h7.5A2.25 2.25 0 0018 20.25V3.75a2.25 2.25 0 00-2.25-2.25H13.5m-3 0V3h3V1.5m-3 0h3m-3 18.75h3" /></svg></div><h3 class="mt-4 font-semibold text-green-800">1. You Ask</h3><p class="text-sm mt-1">You send a question by voice, text, or photo on the app.</p></div>
                <div class="text-green-400 text-2xl transform rotate-90 md:rotate-0">&rarr;</div>
                <!-- Step 2 -->
                <div class="flex flex-col items-center max-w-[200px]"><div class="flex items-center justify-center w-24 h-24 bg-green-100 rounded-full text-green-700"><svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M7.5 21L3 16.5m0 0L7.5 12M3 16.5h13.5m0-13.5L21 7.5m0 0L16.5 12M21 7.5H7.5" /></svg></div><h3 class="mt-4 font-semibold text-green-800">2. AI Understands</h3><p class="text-sm mt-1">The system analyzes your query, language, and location.</p></div>
                <div class="text-green-400 text-2xl transform rotate-90 md:rotate-0">&rarr;</div>
                <!-- Step 3 -->
                <div class="flex flex-col items-center max-w-[200px]"><div class="flex items-center justify-center w-24 h-24 bg-green-700 rounded-full text-white"><svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 3v1.5M4.5 8.25H3m18 0h-1.5M4.5 12H3m18 0h-1.5m-15 3.75H3m18 0h-1.5M8.25 19.5V21M12 3v1.5m0 15V21m3.75-18v1.5m0 15V21m-9-1.5h10.5a2.25 2.25 0 002.25-2.25V6.75a2.25 2.25 0 00-2.25-2.25H6.75A2.25 2.25 0 004.5 6.75v10.5a2.25 2.25 0 002.25 2.25z" /></svg></div><h3 class="mt-4 font-semibold text-green-800">3. AI Finds Answers</h3><p class="text-sm mt-1">It scans market data, soil info, and expert knowledge to craft the best advice.</p></div>
                <div class="text-green-400 text-2xl transform rotate-90 md:rotate-0">&rarr;</div>
                <!-- Step 4 -->
                <div class="flex flex-col items-center max-w-[200px]"><div class="flex items-center justify-center w-24 h-24 bg-green-100 rounded-full text-green-700"><svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M8.625 9.75a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H8.25m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H12m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0h-.375m-13.5 3.01c0 1.6 1.123 2.994 2.707 3.227 1.087.16 2.185.283 3.293.369V21l4.184-4.183a1.125 1.125 0 00.12-1.815.75.75 0 01-.12-1.023A3.375 3.375 0 019.75 7.5c-1.01 0-1.933.52-2.523 1.321" /></svg></div><h3 class="mt-4 font-semibold text-green-800">4. You Get Advice</h3><p class="text-sm mt-1">A simple, clear answer appears on your phone in your language.</p></div>
            </div>
        </section>

        <!-- Expected Impact -->
        <section id="impact" class="section-card">
            <h2>The Impact: Better Yields, Better Lives</h2>
            <p class="mb-8">Agri-Connect is designed for real-world results. We measure our success not in clicks, but in crop yields, income, and time saved for farmers. Here's the change we project for Rajasthan.</p>

            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6 text-center mb-12">
                <div class="bg-white p-4 rounded-lg shadow-md border"><div class="text-3xl md:text-5xl text-green-600 font-bold">15%</div><p class="mt-2 text-sm md:text-base text-gray-600 font-semibold">More Crop Yield</p></div>
                <div class="bg-white p-4 rounded-lg shadow-md border"><div class="text-3xl md:text-5xl text-green-600 font-bold">20%</div><p class="mt-2 text-sm md:text-base text-gray-600 font-semibold">More Farmer Income</p></div>
                <div class="bg-white p-4 rounded-lg shadow-md border"><div class="text-3xl md:text-5xl text-blue-600 font-bold">50%</div><p class="mt-2 text-sm md:text-base text-gray-600 font-semibold">Faster Subsidy Info</p></div>
                <div class="bg-white p-4 rounded-lg shadow-md border"><div class="text-3xl md:text-5xl text-red-500 font-bold">25%</div><p class="mt-2 text-sm md:text-base text-gray-600 font-semibold">Less Pesticide Use</p></div>
            </div>
            
            <div class="grid md:grid-cols-2 gap-8">
                <div class="kpi-card">
                    <h3 class="text-lg font-semibold text-green-800 mb-2">From Hours to Minutes</h3>
                    <p class="text-sm mb-4">A trusted answer for a critical query is now minutes away, not half a day.</p>
                    <canvas id="resolutionTimeChart"></canvas>
                </div>
                <div class="kpi-card">
                    <h3 class="text-lg font-semibold text-green-800 mb-2">Beating the Middleman</h3>
                    <p class="text-sm mb-4">Projected income per hectare when market intelligence empowers direct selling.</p>
                    <canvas id="profitabilityBarChart"></canvas>
                </div>
            </div>
        </section>

        <!-- Agri-Connect Live Demo -->
        <section id="live-demo" class="section-card">
            <h2 class="flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mr-3 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M9.75 3.104v5.714a2.25 2.25 0 01-.659 1.591L5 14.5M9.75 3.104c.252 0 .504 0 .752.011a2.25 2.25 0 012.248 2.248v5.714a2.25 2.25 0 01-.659 1.591L14.25 14.5M9.75 3.104a2.25 2.25 0 00-2.25 2.25v5.714a2.25 2.25 0 00.659 1.591L9.75 14.5m0-11.396c.252 0 .504 0 .752.011a2.25 2.25 0 002.248-2.248M14.25 14.5c.621 0 1.125-.504 1.125-1.125V6.104a2.25 2.25 0 00-2.248-2.248c-.248.01-.499.01-.752.01M14.25 14.5L9.75 21m0 0l-4.5-6.5m4.5 6.5l4.5-6.5" /></svg>
                Try Agri-Connect Now
            </h2>
            <p class="mb-6 text-gray-600">Ask a question below to see how our AI provides instant, helpful advice. This demo uses the Gemini API to simulate a real conversation.</p>
            
            <div class="chat-window bg-white rounded-lg border border-gray-200 shadow-inner flex flex-col h-[60vh] max-h-[700px]">
                <div id="chat-log" class="flex-1 p-4 overflow-y-auto">
                    <div class="ai-bubble">Namaste! I'm your Agri-Connect assistant, ready to help with your farming questions for Rajasthan. How can I help you today?</div>
                </div>
                <div class="p-4 bg-gray-50 border-t">
                    <div class="flex items-center space-x-2">
                        <input type="text" id="queryInput" class="w-full p-3 border border-gray-300 rounded-full focus:ring-green-500 focus:border-green-500 transition" placeholder="Ask about crops, soil, or prices...">
                        <button id="submitQueryBtn" class="bg-green-600 text-white rounded-full p-3 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-transform active:scale-95 disabled:bg-gray-400 disabled:cursor-not-allowed">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 10l7-7m0 0l7 7m-7-7v18" /></svg>
                        </button>
                    </div>
                     <div class="mt-3 text-xs sm:text-sm text-center">
                        <span class="font-medium">Or try:</span>
                        <button class="example-query-btn text-green-700 hover:underline ml-2" data-query="What are the current government subsidies for drip irrigation in Rajasthan?">Drip irrigation subsidies?</button>
                        <button class="example-query-btn text-green-700 hover:underline ml-2" data-query="Best pest control for whitefly on cotton plants?">Whitefly on cotton?</button>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-green-900 text-green-200 mt-8">
        <div class="container mx-auto px-6 py-4 text-center">
            <p>&copy; 2025 Agri-Connect Project. All Rights Reserved.</p>
            <p class="text-sm text-green-300">A Farmer-First Initiative</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Chart.js Configuration
            const queryPieCtx = document.getElementById('queryPieChart').getContext('2d');
            new Chart(queryPieCtx, { type: 'pie', data: { labels: ['Market Linkage & Prices', 'Crop & Soil Advisory', 'Pest & Disease', 'Govt. Schemes', 'Weather', 'Other'], datasets: [{ label: 'Query Distribution', data: [35, 25, 15, 10, 10, 5], backgroundColor: ['#14532d', '#166534', '#15803d', '#16a34a', '#22c55e', '#4ade80'], hoverOffset: 4 }] }, options: { responsive: true, plugins: { legend: { position: 'top' } } } });
            const costOfDelayCtx = document.getElementById('costOfDelayChart').getContext('2d');
            new Chart(costOfDelayCtx, { type: 'bar', data: { labels: ['Pest Attack', 'Sowing Time Query', 'Subsidy Info Delay'], datasets: [{ label: 'Potential Loss per Day (â‚¹)', data: [5500, 3000, 2000], backgroundColor: '#dc2626', borderColor: '#b91c1c', borderWidth: 1 }] }, options: { scales: { y: { beginAtZero: true } }, responsive: true, plugins: { legend: { display: false } } } });
            const resolutionTimeCtx = document.getElementById('resolutionTimeChart').getContext('2d');
            new Chart(resolutionTimeCtx, { type: 'bar', data: { labels: ['Traditional Methods', 'Agri-Connect'], datasets: [{ label: 'Avg. Resolution Time (Minutes)', data: [720, 2], backgroundColor: ['#f59e0b', '#16a34a'], borderWidth: 1 }] }, options: { indexAxis: 'y', scales: { x: { beginAtZero: true } }, responsive: true, plugins: { legend: { display: false } } } });
            const profitabilityBarCtx = document.getElementById('profitabilityBarChart').getContext('2d');
            new Chart(profitabilityBarCtx, { type: 'bar', data: { labels: ['Wheat', 'Mustard', 'Cotton'], datasets: [{ label: 'Income without Agri-Connect (â‚¹)', data: [45000, 48000, 65000], backgroundColor: '#a7f3d0', borderWidth: 1 }, { label: 'Income with Agri-Connect (â‚¹)', data: [54000, 58000, 78000], backgroundColor: '#16a34a', borderWidth: 1 }] }, options: { scales: { y: { beginAtZero: true, ticks: { callback: function(value) { return 'â‚¹' + value / 1000 + 'k'; } } } }, responsive: true, plugins: { legend: { position: 'top' } } } });

            // --- Gemini API Chat Integration ---
            const queryInput = document.getElementById('queryInput');
            const submitBtn = document.getElementById('submitQueryBtn');
            const chatLog = document.getElementById('chat-log');
            const exampleButtons = document.querySelectorAll('.example-query-btn');

            const submitQuery = () => {
                const query = queryInput.value.trim();
                if (query) {
                    addUserMessage(query);
                    generateAdvice(query);
                    queryInput.value = '';
                }
            };
            
            submitBtn.addEventListener('click', submitQuery);
            queryInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    submitQuery();
                }
            });

            exampleButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const query = button.getAttribute('data-query');
                    queryInput.value = query;
                    addUserMessage(query);
                    generateAdvice(query);
                    queryInput.value = '';
                });
            });
            
            function addUserMessage(message) {
                const userBubble = document.createElement('div');
                userBubble.className = 'chat-bubble user-bubble';
                userBubble.textContent = message;
                chatLog.appendChild(userBubble);
                chatLog.scrollTop = chatLog.scrollHeight;
            }

            function addAIBubble(content, isHtml = false) {
                 const aiBubble = document.createElement('div');
                 aiBubble.className = 'chat-bubble ai-bubble';
                 if (isHtml) {
                    aiBubble.innerHTML = content;
                 } else {
                    aiBubble.textContent = content;
                 }
                 chatLog.appendChild(aiBubble);
                 chatLog.scrollTop = chatLog.scrollHeight;
                 return aiBubble;
            }

            async function generateAdvice(userQuery) {
                submitBtn.disabled = true;
                const thinkingBubble = addAIBubble('<div class="thinking-bubble"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>', true);

                const systemPrompt = "You are Agri-Connect, an expert AI assistant for farmers in Rajasthan, India. Provide clear, concise, and actionable advice in simple, easy-to-understand language. If the query is in Hindi, respond in Hindi. Your knowledge base includes local crop calendars for Rajasthan, pest advisories, weather patterns, and Indian government scheme guidelines. Always consider the current date and the location as Rajasthan to give hyper-local advice. Start your response with a friendly greeting and format key points using markdown (e.g., **bolding** and * lists).";
                const apiKey = ""; // Handled by environment
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                const payload = { contents: [{ parts: [{ text: userQuery }] }], tools: [{ "google_search": {} }], systemInstruction: { parts: [{ text: systemPrompt }] } };

                try {
                    const response = await fetchWithExponentialBackoff(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                    if (!response.ok) throw new Error(`API error: ${response.statusText}`);
                    const result = await response.json();
                    const candidate = result.candidates?.[0];
                    chatLog.removeChild(thinkingBubble);
                    
                    if (candidate && candidate.content?.parts?.[0]?.text) {
                        let text = candidate.content.parts[0].text;
                        let htmlText = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/^\s*\*\s+(.*$)/gm, '<li class="ml-4 list-disc">$1</li>');
                        htmlText = htmlText.replace(/(<li>.*<\/li>)/s, '<ul>$1</ul>').replace(/\n/g, '<br>');
                        addAIBubble(htmlText, true);
                    } else {
                        addAIBubble('Sorry, I couldn\'t find an answer. Please try asking in a different way.');
                        console.error('Unexpected API response:', result);
                    }
                } catch (error) {
                    chatLog.removeChild(thinkingBubble);
                    addAIBubble('Sorry, I\'m having trouble connecting. Please try again in a moment.');
                    console.error('Gemini API Error:', error);
                } finally {
                    submitBtn.disabled = false;
                    queryInput.focus();
                }
            }

            async function fetchWithExponentialBackoff(url, options, retries = 3, backoff = 1000) {
                for (let i = 0; i < retries; i++) {
                    try {
                        const response = await fetch(url, options);
                        if (response.status === 429) throw new Error('Rate limited');
                        if (!response.ok) console.warn(`Attempt ${i + 1} failed: ${response.status}`);
                        else return response;
                    } catch (error) {
                        if (i === retries - 1) throw error;
                        await new Promise(resolve => setTimeout(resolve, backoff * Math.pow(2, i) + Math.random() * 100));
                    }
                }
                throw new Error('Max retries reached');
            }
        });
    </script>
</body>
</html>

